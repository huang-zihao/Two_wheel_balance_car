# 一、动力学分析
1.对两个轮子和车体受力分析（直接参考论文
2.建立动力学微分方程（直接参考论文


# 二、器材的使用
最重要的两个器材，MPU5060，电机驱动模块

## MPU5060（姿态检测：3轴加速度传感器+3轴角速度传感器
1.mpu6050是采用的I2C通信，需要将开发板BOOT1和BOOT0置于0
2.需要进行滤波操作，在z轴加速度上误差特别大

![image](https://user-images.githubusercontent.com/109507018/180629533-ad665100-ab85-4ac0-877a-4f38ea61dc0e.png)

可以通过简单均值滤波处理一下，即将开始读取的一部分数据进行平均，再于获取函数中减去（注意在z轴加速度需要补回，因为一开始是打算z轴朝上进行稳定值得读取）


## AB向无刷直流电机
AB向编码器：

![image](https://user-images.githubusercontent.com/109507018/180652436-93de5264-e845-45ea-97a9-416221dedffb.png)


旋转方向：A上升沿，B低电平————顺时针转    A下降沿，B高电平————一次顺时针转结束
          
          A上升沿，B高电平————逆时针转    A下降沿，B低电平————一次逆时针转结束
          
即顺转（10——01），逆转（11——00）。

计数方式，如果是顺转————计A上升沿个数

无刷直流驱动方式：
直接pwm单向输入即可
但是需要驱动、稳压（至5V）
烧坏了一个TB6612（只接VCC、GND就冒烟了，排除电源接反，好像是PWM口之前接高电平，可能是？）
目前使用L298N，体型比较大

# 三、算法
控制算法（模糊、神经网络

控制的想法就是：
向着倾斜的方向行驶，直至直立。
PID中只需要用PD，因为这里不考虑倾斜角的精确，只想快速稳定，那么e就是角度差，ec就是角度速度变化率（角速度），直立环就好了。
平衡车为什么只有角度环不够，还需要速度环：
因为当角度环有偏差的时候，根据角度环的pid是可以给小车输出pwm波维持小车平衡的，但是小车要以什么样的速度维持平衡角度环是做不到的，加上速度环的目的就是于此。
直立环PD：Kp*(角度-期望角度)+Kd*(角速度-0)
速度环PI: Kp*(速度-期望速度)+Ki*位移
转向环PD: 就输出两个方向相反的就行了

## 直立环：
作用：维持直立平衡
设想：参考钟摆逐渐停下的过程1.偏差越大，加速度越大，下一刻速度越大  2.运动速度越大，阻力越大，下一刻速度越小
给一个倾斜，Kp、Kd作用，当倾斜不在增大，Kp作用，当要扶正角度，倾斜角速度反方向增大，此时Kp - Kd的作用，Kd类似阻尼
## 速度环：

往往，我们只使用直立环，小车只能短暂的平衡几秒，然后就朝着一个方向倒去了。
只有直立环的平衡小车会倒下的原因：没有对小车平移速度没有限制，这样就可能超过PWM的幅值，导致电机无法加速了，也就没有了有效的回复力，所以小车就倒了。

作用：在小车平衡的同时，尽量让小车车身保持静止，就是小车车身速度为零，也就是对小车平移速度进行限制
设想：既然在一顿平衡操作之后，我们得到的是一个带有直立环的小车系统，既然还有小车速度需要控制，那就再加一个速度控制器PI，考虑现实中有一定阻力不用微分。

# 卡尔曼、互补滤波器

关于神经网络的个人笔记https://blog.csdn.net/m0_49788555/article/details/126255952?spm=1001.2014.3001.5501

四、代码、参数整理调节
